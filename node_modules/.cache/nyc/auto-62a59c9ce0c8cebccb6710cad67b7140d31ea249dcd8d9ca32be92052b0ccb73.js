// @ts-check
'use strict';function cov_spgo402re(){var path="/root/.nvs/lib/auto.js";var hash="9c6b0aedad050df4de61b330e607d4093a5a7bc7";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/root/.nvs/lib/auto.js",statementMap:{"0":{start:{line:4,column:9},end:{line:4,column:22}},"1":{start:{line:5,column:11},end:{line:5,column:24}},"2":{start:{line:6,column:13},end:{line:6,column:28}},"3":{start:{line:8,column:17},end:{line:8,column:47}},"4":{start:{line:9,column:14},end:{line:9,column:32}},"5":{start:{line:11,column:20},end:{line:11,column:40}},"6":{start:{line:12,column:13},end:{line:12,column:29}},"7":{start:{line:13,column:19},end:{line:13,column:41}},"8":{start:{line:14,column:14},end:{line:14,column:31}},"9":{start:{line:15,column:14},end:{line:15,column:18}},"10":{start:{line:23,column:15},end:{line:23,column:19}},"11":{start:{line:24,column:11},end:{line:24,column:31}},"12":{start:{line:25,column:1},end:{line:56,column:2}},"13":{start:{line:26,column:20},end:{line:26,column:51}},"14":{start:{line:28,column:2},end:{line:32,column:3}},"15":{start:{line:29,column:3},end:{line:29,column:63}},"16":{start:{line:31,column:3},end:{line:31,column:76}},"17":{start:{line:35,column:2},end:{line:42,column:3}},"18":{start:{line:36,column:3},end:{line:36,column:42}},"19":{start:{line:37,column:3},end:{line:41,column:4}},"20":{start:{line:38,column:4},end:{line:38,column:64}},"21":{start:{line:40,column:4},end:{line:40,column:77}},"22":{start:{line:44,column:2},end:{line:52,column:3}},"23":{start:{line:45,column:3},end:{line:51,column:4}},"24":{start:{line:46,column:4},end:{line:46,column:47}},"25":{start:{line:47,column:4},end:{line:47,column:55}},"26":{start:{line:48,column:4},end:{line:48,column:10}},"27":{start:{line:50,column:4},end:{line:50,column:74}},"28":{start:{line:54,column:18},end:{line:54,column:35}},"29":{start:{line:55,column:2},end:{line:55,column:47}},"30":{start:{line:58,column:1},end:{line:74,column:2}},"31":{start:{line:59,column:24},end:{line:59,column:45}},"32":{start:{line:60,column:2},end:{line:70,column:3}},"33":{start:{line:61,column:3},end:{line:61,column:43}},"34":{start:{line:63,column:3},end:{line:65,column:4}},"35":{start:{line:64,column:4},end:{line:64,column:38}},"36":{start:{line:67,column:3},end:{line:69,column:6}},"37":{start:{line:68,column:4},end:{line:68,column:19}},"38":{start:{line:72,column:2},end:{line:72,column:41}},"39":{start:{line:73,column:2},end:{line:73,column:72}},"40":{start:{line:83,column:1},end:{line:89,column:2}},"41":{start:{line:84,column:2},end:{line:88,column:38}},"42":{start:{line:91,column:1},end:{line:93,column:4}},"43":{start:{line:92,column:2},end:{line:92,column:29}},"44":{start:{line:104,column:1},end:{line:107,column:2}},"45":{start:{line:105,column:2},end:{line:106,column:39}},"46":{start:{line:109,column:20},end:{line:109,column:71}},"47":{start:{line:111,column:1},end:{line:147,column:2}},"48":{start:{line:112,column:2},end:{line:130,column:5}},"49":{start:{line:132,column:2},end:{line:146,column:5}},"50":{start:{line:150,column:0},end:{line:154,column:2}}},fnMap:{"0":{name:"findAutoVersionAsync",decl:{start:{line:22,column:9},end:{line:22,column:29}},loc:{start:{line:22,column:35},end:{line:75,column:1}},line:22},"1":{name:"(anonymous_1)",decl:{start:{line:67,column:46},end:{line:67,column:47}},loc:{start:{line:67,column:52},end:{line:69,column:4}},line:67},"2":{name:"autoSwitchAsync",decl:{start:{line:82,column:9},end:{line:82,column:24}},loc:{start:{line:82,column:30},end:{line:94,column:1}},line:82},"3":{name:"(anonymous_3)",decl:{start:{line:91,column:39},end:{line:91,column:40}},loc:{start:{line:91,column:50},end:{line:93,column:2}},line:91},"4":{name:"enableAutoSwitch",decl:{start:{line:103,column:9},end:{line:103,column:25}},loc:{start:{line:103,column:34},end:{line:148,column:1}},line:103}},branchMap:{"0":{loc:{start:{line:24,column:11},end:{line:24,column:31}},type:"binary-expr",locations:[{start:{line:24,column:11},end:{line:24,column:14}},{start:{line:24,column:18},end:{line:24,column:31}}],line:24},"1":{loc:{start:{line:35,column:2},end:{line:42,column:3}},type:"if",locations:[{start:{line:35,column:2},end:{line:42,column:3}},{start:{line:35,column:2},end:{line:42,column:3}}],line:35},"2":{loc:{start:{line:35,column:6},end:{line:35,column:46}},type:"binary-expr",locations:[{start:{line:35,column:6},end:{line:35,column:20}},{start:{line:35,column:24},end:{line:35,column:46}}],line:35},"3":{loc:{start:{line:44,column:2},end:{line:52,column:3}},type:"if",locations:[{start:{line:44,column:2},end:{line:52,column:3}},{start:{line:44,column:2},end:{line:52,column:3}}],line:44},"4":{loc:{start:{line:47,column:19},end:{line:47,column:54}},type:"binary-expr",locations:[{start:{line:47,column:19},end:{line:47,column:31}},{start:{line:47,column:35},end:{line:47,column:54}}],line:47},"5":{loc:{start:{line:55,column:9},end:{line:55,column:45}},type:"cond-expr",locations:[{start:{line:55,column:29},end:{line:55,column:38}},{start:{line:55,column:41},end:{line:55,column:45}}],line:55},"6":{loc:{start:{line:58,column:1},end:{line:74,column:2}},type:"if",locations:[{start:{line:58,column:1},end:{line:74,column:2}},{start:{line:58,column:1},end:{line:74,column:2}}],line:58},"7":{loc:{start:{line:60,column:2},end:{line:70,column:3}},type:"if",locations:[{start:{line:60,column:2},end:{line:70,column:3}},{start:{line:60,column:2},end:{line:70,column:3}}],line:60},"8":{loc:{start:{line:63,column:3},end:{line:65,column:4}},type:"if",locations:[{start:{line:63,column:3},end:{line:65,column:4}},{start:{line:63,column:3},end:{line:65,column:4}}],line:63},"9":{loc:{start:{line:72,column:12},end:{line:72,column:40}},type:"binary-expr",locations:[{start:{line:72,column:12},end:{line:72,column:19}},{start:{line:72,column:23},end:{line:72,column:40}}],line:72},"10":{loc:{start:{line:73,column:25},end:{line:73,column:70}},type:"cond-expr",locations:[{start:{line:73,column:54},end:{line:73,column:63}},{start:{line:73,column:66},end:{line:73,column:70}}],line:73},"11":{loc:{start:{line:83,column:1},end:{line:89,column:2}},type:"if",locations:[{start:{line:83,column:1},end:{line:89,column:2}},{start:{line:83,column:1},end:{line:89,column:2}}],line:83},"12":{loc:{start:{line:104,column:1},end:{line:107,column:2}},type:"if",locations:[{start:{line:104,column:1},end:{line:107,column:2}},{start:{line:104,column:1},end:{line:107,column:2}}],line:104},"13":{loc:{start:{line:111,column:1},end:{line:147,column:2}},type:"if",locations:[{start:{line:111,column:1},end:{line:147,column:2}},{start:{line:111,column:1},end:{line:147,column:2}}],line:111}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"9c6b0aedad050df4de61b330e607d4093a5a7bc7"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_spgo402re=function(){return actualCoverage;};}return actualCoverage;}cov_spgo402re();let fs=(cov_spgo402re().s[0]++,require('fs'));// Non-const enables test mocking
const os=(cov_spgo402re().s[1]++,require('os'));const path=(cov_spgo402re().s[2]++,require('path'));const settings=(cov_spgo402re().s[3]++,require('./settings').settings);const Error=(cov_spgo402re().s[4]++,require('./error'));const NodeVersion=(cov_spgo402re().s[5]++,require('./version'));let nvsUse=(cov_spgo402re().s[6]++,require('./use'));// Non-const enables test mocking
let nvsAddRemove=(cov_spgo402re().s[7]++,require('./addRemove'));// Non-const enables test mocking
let nvsList=(cov_spgo402re().s[8]++,require('./list'));// Non-const enables test mocking
let nvsLink=(cov_spgo402re().s[9]++,null);// Lazy load
/**
 * Searches for the nearest `.node-version` or `.nvmrc` file in the current directory or parent directories.
 * If found, the version specified in the file is then added (if necessary) and returned. If no
 * `.node-version` or `.nvmrc` file is found then 'default' is returned.
 */function findAutoVersionAsync(cwd){cov_spgo402re().f[0]++;let version=(cov_spgo402re().s[10]++,null);let dir=(cov_spgo402re().s[11]++,(cov_spgo402re().b[0][0]++,cwd)||(cov_spgo402re().b[0][1]++,process.cwd()));cov_spgo402re().s[12]++;while(dir){let versionFile=(cov_spgo402re().s[13]++,path.join(dir,'.node-version'));let versionString;cov_spgo402re().s[14]++;try{cov_spgo402re().s[15]++;versionString=fs.readFileSync(versionFile,'utf8').trim();}catch(e){cov_spgo402re().s[16]++;Error.throwIfNot(Error.ENOENT,e,'Failed to read file: '+versionFile);}// If we don't have a version string, try checking for an .nvmrc file
cov_spgo402re().s[17]++;if((cov_spgo402re().b[2][0]++,!versionString)&&(cov_spgo402re().b[2][1]++,!settings.disableNvmrc)){cov_spgo402re().b[1][0]++;cov_spgo402re().s[18]++;versionFile=path.join(dir,'.nvmrc');cov_spgo402re().s[19]++;try{cov_spgo402re().s[20]++;versionString=fs.readFileSync(versionFile,'utf8').trim();}catch(e){cov_spgo402re().s[21]++;Error.throwIfNot(Error.ENOENT,e,'Failed to read file: '+versionFile);}}else{cov_spgo402re().b[1][1]++;}cov_spgo402re().s[22]++;if(versionString){cov_spgo402re().b[3][0]++;cov_spgo402re().s[23]++;try{cov_spgo402re().s[24]++;version=NodeVersion.parse(versionString);cov_spgo402re().s[25]++;version.arch=(cov_spgo402re().b[4][0]++,version.arch)||(cov_spgo402re().b[4][1]++,version.defaultArch);cov_spgo402re().s[26]++;break;}catch(e){cov_spgo402re().s[27]++;throw new Error('Failed to parse version in file: '+versionFile,e);}}else{cov_spgo402re().b[3][1]++;}let parentDir=(cov_spgo402re().s[28]++,path.dirname(dir));cov_spgo402re().s[29]++;dir=parentDir!==dir?(cov_spgo402re().b[5][0]++,parentDir):(cov_spgo402re().b[5][1]++,null);}cov_spgo402re().s[30]++;if(version){cov_spgo402re().b[6][0]++;let resolvedVersion=(cov_spgo402re().s[31]++,nvsList.find(version));cov_spgo402re().s[32]++;if(resolvedVersion){cov_spgo402re().b[7][0]++;cov_spgo402re().s[33]++;return Promise.resolve(resolvedVersion);}else{cov_spgo402re().b[7][1]++;cov_spgo402re().s[34]++;if(!settings.quiet){cov_spgo402re().b[8][0]++;cov_spgo402re().s[35]++;console.log('Adding: '+version);}else{cov_spgo402re().b[8][1]++;}cov_spgo402re().s[36]++;return nvsAddRemove.addAsync(version).then(()=>{cov_spgo402re().f[1]++;cov_spgo402re().s[37]++;return version;});}}else{cov_spgo402re().b[6][1]++;cov_spgo402re().s[38]++;nvsLink=(cov_spgo402re().b[9][0]++,nvsLink)||(cov_spgo402re().b[9][1]++,require('./link'));cov_spgo402re().s[39]++;return Promise.resolve(nvsLink.getLinkedVersion()?(cov_spgo402re().b[10][0]++,'default'):(cov_spgo402re().b[10][1]++,null));}}/**
 * Searches for the nearest `.node-version` or `.nvmrc` file in the current directory or parent directories.
 * If found, the version specified in the file is then added (if necessary) and used. If no
 * `.node-version` or `.nvmrc` file is found, then the default (linked) version, if any, is used.
 */function autoSwitchAsync(cwd){cov_spgo402re().f[2]++;cov_spgo402re().s[40]++;if(process.env['NVS_EXECUTE']){cov_spgo402re().b[11][0]++;cov_spgo402re().s[41]++;throw new Error('The \'auto\' command is not available when '+'invoking this script as an'+os.EOL+'executable. To enable PATH updates, source '+'nvs.sh from your shell instead.');}else{cov_spgo402re().b[11][1]++;}cov_spgo402re().s[42]++;return findAutoVersionAsync(cwd).then(version=>{cov_spgo402re().f[3]++;cov_spgo402re().s[43]++;return nvsUse.use(version);});}/**
 * Enables or disables automatic version switching based on the presence of a
 * .node-version file in the current shell directory or a parent directory.
 * (This functionality requires support from the bootstrap shell script.)
 *
 * @param {any} enable
 */function enableAutoSwitch(enable){cov_spgo402re().f[4]++;cov_spgo402re().s[44]++;if(/\.cmd/i.test(process.env['NVS_POSTSCRIPT'])){cov_spgo402re().b[12][0]++;cov_spgo402re().s[45]++;throw new Error('Automatic switching is not supported from a Windows Command Prompt.'+os.EOL+'Use PowerShell instead.');}else{cov_spgo402re().b[12][1]++;}let psScriptFile=(cov_spgo402re().s[46]++,path.join(path.resolve(__dirname,'..'),'nvs.ps1'));cov_spgo402re().s[47]++;if(enable){cov_spgo402re().b[13][0]++;cov_spgo402re().s[48]++;require('./postScript').generate(null,{'.PS1':[// Patch the function that is invoked every time PowerShell shows a prompt.
// Export the function from the script using a dynamic module; this
// does NOT require the script to be sourced.
'if (-not $env:NVS_ORIGINAL_PROMPT) { ','   $env:NVS_ORIGINAL_PROMPT = $(Get-Content function:\\prompt)','}','New-Module -Script {','   function prompt { . "'+psScriptFile+'" "prompt" }','   Export-ModuleMember -Function prompt','} > $null'],'.SH':['function cd () { builtin cd "$@" && nvs cd; }','function pushd () { builtin pushd "$@" && nvs cd; }','function popd () { builtin popd "$@" && nvs cd; }']});}else{cov_spgo402re().b[13][1]++;cov_spgo402re().s[49]++;require('./postScript').generate(null,{'.PS1':['if ($env:NVS_ORIGINAL_PROMPT) { ','   New-Module -Script {','      function prompt { Invoke-Expression $env:NVS_ORIGINAL_PROMPT }','      Export-ModuleMember -Function prompt','   } > $null','}'],'.SH':['function cd () { builtin cd "$@"; }','function pushd () { builtin pushd "$@"; }','function popd () { builtin popd "$@"; }']});}}cov_spgo402re().s[50]++;module.exports={findAutoVersionAsync,autoSwitchAsync,enableAutoSwitch};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJvcyIsInBhdGgiLCJzZXR0aW5ncyIsIkVycm9yIiwiTm9kZVZlcnNpb24iLCJudnNVc2UiLCJudnNBZGRSZW1vdmUiLCJudnNMaXN0IiwibnZzTGluayIsImZpbmRBdXRvVmVyc2lvbkFzeW5jIiwiY3dkIiwidmVyc2lvbiIsImRpciIsInByb2Nlc3MiLCJ2ZXJzaW9uRmlsZSIsImpvaW4iLCJ2ZXJzaW9uU3RyaW5nIiwicmVhZEZpbGVTeW5jIiwidHJpbSIsImUiLCJ0aHJvd0lmTm90IiwiRU5PRU5UIiwiZGlzYWJsZU52bXJjIiwicGFyc2UiLCJhcmNoIiwiZGVmYXVsdEFyY2giLCJwYXJlbnREaXIiLCJkaXJuYW1lIiwicmVzb2x2ZWRWZXJzaW9uIiwiZmluZCIsIlByb21pc2UiLCJyZXNvbHZlIiwicXVpZXQiLCJjb25zb2xlIiwibG9nIiwiYWRkQXN5bmMiLCJ0aGVuIiwiZ2V0TGlua2VkVmVyc2lvbiIsImF1dG9Td2l0Y2hBc3luYyIsImVudiIsIkVPTCIsInVzZSIsImVuYWJsZUF1dG9Td2l0Y2giLCJlbmFibGUiLCJ0ZXN0IiwicHNTY3JpcHRGaWxlIiwiX19kaXJuYW1lIiwiZ2VuZXJhdGUiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiYXV0by5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdHMtY2hlY2tcbid1c2Ugc3RyaWN0JztcblxubGV0IGZzID0gcmVxdWlyZSgnZnMnKTsgIC8vIE5vbi1jb25zdCBlbmFibGVzIHRlc3QgbW9ja2luZ1xuY29uc3Qgb3MgPSByZXF1aXJlKCdvcycpO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcblxuY29uc3Qgc2V0dGluZ3MgPSByZXF1aXJlKCcuL3NldHRpbmdzJykuc2V0dGluZ3M7XG5jb25zdCBFcnJvciA9IHJlcXVpcmUoJy4vZXJyb3InKTtcblxuY29uc3QgTm9kZVZlcnNpb24gPSByZXF1aXJlKCcuL3ZlcnNpb24nKTtcbmxldCBudnNVc2UgPSByZXF1aXJlKCcuL3VzZScpOyAgLy8gTm9uLWNvbnN0IGVuYWJsZXMgdGVzdCBtb2NraW5nXG5sZXQgbnZzQWRkUmVtb3ZlID0gcmVxdWlyZSgnLi9hZGRSZW1vdmUnKTsgIC8vIE5vbi1jb25zdCBlbmFibGVzIHRlc3QgbW9ja2luZ1xubGV0IG52c0xpc3QgPSByZXF1aXJlKCcuL2xpc3QnKTsgIC8vIE5vbi1jb25zdCBlbmFibGVzIHRlc3QgbW9ja2luZ1xubGV0IG52c0xpbmsgPSBudWxsOyAgLy8gTGF6eSBsb2FkXG5cbi8qKlxuICogU2VhcmNoZXMgZm9yIHRoZSBuZWFyZXN0IGAubm9kZS12ZXJzaW9uYCBvciBgLm52bXJjYCBmaWxlIGluIHRoZSBjdXJyZW50IGRpcmVjdG9yeSBvciBwYXJlbnQgZGlyZWN0b3JpZXMuXG4gKiBJZiBmb3VuZCwgdGhlIHZlcnNpb24gc3BlY2lmaWVkIGluIHRoZSBmaWxlIGlzIHRoZW4gYWRkZWQgKGlmIG5lY2Vzc2FyeSkgYW5kIHJldHVybmVkLiBJZiBub1xuICogYC5ub2RlLXZlcnNpb25gIG9yIGAubnZtcmNgIGZpbGUgaXMgZm91bmQgdGhlbiAnZGVmYXVsdCcgaXMgcmV0dXJuZWQuXG4gKi9cbmZ1bmN0aW9uIGZpbmRBdXRvVmVyc2lvbkFzeW5jKGN3ZCkge1xuXHRsZXQgdmVyc2lvbiA9IG51bGw7XG5cdGxldCBkaXIgPSBjd2QgfHwgcHJvY2Vzcy5jd2QoKTtcblx0d2hpbGUgKGRpcikge1xuXHRcdGxldCB2ZXJzaW9uRmlsZSA9IHBhdGguam9pbihkaXIsICcubm9kZS12ZXJzaW9uJyk7XG5cdFx0bGV0IHZlcnNpb25TdHJpbmc7XG5cdFx0dHJ5IHtcblx0XHRcdHZlcnNpb25TdHJpbmcgPSBmcy5yZWFkRmlsZVN5bmModmVyc2lvbkZpbGUsICd1dGY4JykudHJpbSgpO1xuXHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdEVycm9yLnRocm93SWZOb3QoRXJyb3IuRU5PRU5ULCBlLCAnRmFpbGVkIHRvIHJlYWQgZmlsZTogJyArIHZlcnNpb25GaWxlKTtcblx0XHR9XG5cblx0XHQvLyBJZiB3ZSBkb24ndCBoYXZlIGEgdmVyc2lvbiBzdHJpbmcsIHRyeSBjaGVja2luZyBmb3IgYW4gLm52bXJjIGZpbGVcblx0XHRpZiAoIXZlcnNpb25TdHJpbmcgJiYgIXNldHRpbmdzLmRpc2FibGVOdm1yYykge1xuXHRcdFx0dmVyc2lvbkZpbGUgPSBwYXRoLmpvaW4oZGlyLCAnLm52bXJjJyk7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHR2ZXJzaW9uU3RyaW5nID0gZnMucmVhZEZpbGVTeW5jKHZlcnNpb25GaWxlLCAndXRmOCcpLnRyaW0oKTtcblx0XHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdFx0RXJyb3IudGhyb3dJZk5vdChFcnJvci5FTk9FTlQsIGUsICdGYWlsZWQgdG8gcmVhZCBmaWxlOiAnICsgdmVyc2lvbkZpbGUpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh2ZXJzaW9uU3RyaW5nKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHR2ZXJzaW9uID0gTm9kZVZlcnNpb24ucGFyc2UodmVyc2lvblN0cmluZyk7XG5cdFx0XHRcdHZlcnNpb24uYXJjaCA9IHZlcnNpb24uYXJjaCB8fCB2ZXJzaW9uLmRlZmF1bHRBcmNoO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gcGFyc2UgdmVyc2lvbiBpbiBmaWxlOiAnICsgdmVyc2lvbkZpbGUsIGUpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGxldCBwYXJlbnREaXIgPSBwYXRoLmRpcm5hbWUoZGlyKTtcblx0XHRkaXIgPSAocGFyZW50RGlyICE9PSBkaXIgPyBwYXJlbnREaXIgOiBudWxsKTtcblx0fVxuXG5cdGlmICh2ZXJzaW9uKSB7XG5cdFx0bGV0IHJlc29sdmVkVmVyc2lvbiA9IG52c0xpc3QuZmluZCh2ZXJzaW9uKTtcblx0XHRpZiAocmVzb2x2ZWRWZXJzaW9uKSB7XG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc29sdmVkVmVyc2lvbik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmICghc2V0dGluZ3MucXVpZXQpIHtcblx0XHRcdFx0Y29uc29sZS5sb2coJ0FkZGluZzogJyArIHZlcnNpb24pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnZzQWRkUmVtb3ZlLmFkZEFzeW5jKHZlcnNpb24pLnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRyZXR1cm4gdmVyc2lvbjtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHRudnNMaW5rID0gbnZzTGluayB8fCByZXF1aXJlKCcuL2xpbmsnKTtcblx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG52c0xpbmsuZ2V0TGlua2VkVmVyc2lvbigpID8gJ2RlZmF1bHQnIDogbnVsbCk7XG5cdH1cbn1cblxuLyoqXG4gKiBTZWFyY2hlcyBmb3IgdGhlIG5lYXJlc3QgYC5ub2RlLXZlcnNpb25gIG9yIGAubnZtcmNgIGZpbGUgaW4gdGhlIGN1cnJlbnQgZGlyZWN0b3J5IG9yIHBhcmVudCBkaXJlY3Rvcmllcy5cbiAqIElmIGZvdW5kLCB0aGUgdmVyc2lvbiBzcGVjaWZpZWQgaW4gdGhlIGZpbGUgaXMgdGhlbiBhZGRlZCAoaWYgbmVjZXNzYXJ5KSBhbmQgdXNlZC4gSWYgbm9cbiAqIGAubm9kZS12ZXJzaW9uYCBvciBgLm52bXJjYCBmaWxlIGlzIGZvdW5kLCB0aGVuIHRoZSBkZWZhdWx0IChsaW5rZWQpIHZlcnNpb24sIGlmIGFueSwgaXMgdXNlZC5cbiAqL1xuZnVuY3Rpb24gYXV0b1N3aXRjaEFzeW5jKGN3ZCkge1xuXHRpZiAocHJvY2Vzcy5lbnZbJ05WU19FWEVDVVRFJ10pIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoXG5cdFx0XHQnVGhlIFxcJ2F1dG9cXCcgY29tbWFuZCBpcyBub3QgYXZhaWxhYmxlIHdoZW4gJyArXG5cdFx0XHQnaW52b2tpbmcgdGhpcyBzY3JpcHQgYXMgYW4nICsgb3MuRU9MICtcblx0XHRcdCdleGVjdXRhYmxlLiBUbyBlbmFibGUgUEFUSCB1cGRhdGVzLCBzb3VyY2UgJyArXG5cdFx0XHQnbnZzLnNoIGZyb20geW91ciBzaGVsbCBpbnN0ZWFkLicpO1xuXHR9XG5cblx0cmV0dXJuIGZpbmRBdXRvVmVyc2lvbkFzeW5jKGN3ZCkudGhlbih2ZXJzaW9uID0+IHtcblx0XHRyZXR1cm4gbnZzVXNlLnVzZSh2ZXJzaW9uKTtcblx0fSk7XG59XG5cbi8qKlxuICogRW5hYmxlcyBvciBkaXNhYmxlcyBhdXRvbWF0aWMgdmVyc2lvbiBzd2l0Y2hpbmcgYmFzZWQgb24gdGhlIHByZXNlbmNlIG9mIGFcbiAqIC5ub2RlLXZlcnNpb24gZmlsZSBpbiB0aGUgY3VycmVudCBzaGVsbCBkaXJlY3Rvcnkgb3IgYSBwYXJlbnQgZGlyZWN0b3J5LlxuICogKFRoaXMgZnVuY3Rpb25hbGl0eSByZXF1aXJlcyBzdXBwb3J0IGZyb20gdGhlIGJvb3RzdHJhcCBzaGVsbCBzY3JpcHQuKVxuICpcbiAqIEBwYXJhbSB7YW55fSBlbmFibGVcbiAqL1xuZnVuY3Rpb24gZW5hYmxlQXV0b1N3aXRjaChlbmFibGUpIHtcblx0aWYgKC9cXC5jbWQvaS50ZXN0KHByb2Nlc3MuZW52WydOVlNfUE9TVFNDUklQVCddKSkge1xuXHRcdHRocm93IG5ldyBFcnJvcignQXV0b21hdGljIHN3aXRjaGluZyBpcyBub3Qgc3VwcG9ydGVkIGZyb20gYSBXaW5kb3dzIENvbW1hbmQgUHJvbXB0LicgK1xuXHRcdFx0b3MuRU9MICsgJ1VzZSBQb3dlclNoZWxsIGluc3RlYWQuJyk7XG5cdH1cblxuXHRsZXQgcHNTY3JpcHRGaWxlID0gcGF0aC5qb2luKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLicpLCAnbnZzLnBzMScpO1xuXG5cdGlmIChlbmFibGUpIHtcblx0XHRyZXF1aXJlKCcuL3Bvc3RTY3JpcHQnKS5nZW5lcmF0ZShudWxsLCB7XG5cdFx0XHQnLlBTMSc6IFtcblx0XHRcdFx0Ly8gUGF0Y2ggdGhlIGZ1bmN0aW9uIHRoYXQgaXMgaW52b2tlZCBldmVyeSB0aW1lIFBvd2VyU2hlbGwgc2hvd3MgYSBwcm9tcHQuXG5cdFx0XHRcdC8vIEV4cG9ydCB0aGUgZnVuY3Rpb24gZnJvbSB0aGUgc2NyaXB0IHVzaW5nIGEgZHluYW1pYyBtb2R1bGU7IHRoaXNcblx0XHRcdFx0Ly8gZG9lcyBOT1QgcmVxdWlyZSB0aGUgc2NyaXB0IHRvIGJlIHNvdXJjZWQuXG5cdFx0XHRcdCdpZiAoLW5vdCAkZW52Ok5WU19PUklHSU5BTF9QUk9NUFQpIHsgJyxcblx0XHRcdFx0JyAgICRlbnY6TlZTX09SSUdJTkFMX1BST01QVCA9ICQoR2V0LUNvbnRlbnQgZnVuY3Rpb246XFxcXHByb21wdCknLFxuXHRcdFx0XHQnfScsXG5cdFx0XHRcdCdOZXctTW9kdWxlIC1TY3JpcHQgeycsXG5cdFx0XHRcdCcgICBmdW5jdGlvbiBwcm9tcHQgeyAuIFwiJyArIHBzU2NyaXB0RmlsZSArICdcIiBcInByb21wdFwiIH0nLFxuXHRcdFx0XHQnICAgRXhwb3J0LU1vZHVsZU1lbWJlciAtRnVuY3Rpb24gcHJvbXB0Jyxcblx0XHRcdFx0J30gPiAkbnVsbCcsXG5cdFx0XHRdLFxuXHRcdFx0Jy5TSCc6IFtcblx0XHRcdFx0J2Z1bmN0aW9uIGNkICgpIHsgYnVpbHRpbiBjZCBcIiRAXCIgJiYgbnZzIGNkOyB9Jyxcblx0XHRcdFx0J2Z1bmN0aW9uIHB1c2hkICgpIHsgYnVpbHRpbiBwdXNoZCBcIiRAXCIgJiYgbnZzIGNkOyB9Jyxcblx0XHRcdFx0J2Z1bmN0aW9uIHBvcGQgKCkgeyBidWlsdGluIHBvcGQgXCIkQFwiICYmIG52cyBjZDsgfScsXG5cdFx0XHRdLFxuXHRcdH0pO1xuXHR9IGVsc2Uge1xuXHRcdHJlcXVpcmUoJy4vcG9zdFNjcmlwdCcpLmdlbmVyYXRlKG51bGwsIHtcblx0XHRcdCcuUFMxJzogW1xuXHRcdFx0XHQnaWYgKCRlbnY6TlZTX09SSUdJTkFMX1BST01QVCkgeyAnLFxuXHRcdFx0XHQnICAgTmV3LU1vZHVsZSAtU2NyaXB0IHsnLFxuXHRcdFx0XHQnICAgICAgZnVuY3Rpb24gcHJvbXB0IHsgSW52b2tlLUV4cHJlc3Npb24gJGVudjpOVlNfT1JJR0lOQUxfUFJPTVBUIH0nLFxuXHRcdFx0XHQnICAgICAgRXhwb3J0LU1vZHVsZU1lbWJlciAtRnVuY3Rpb24gcHJvbXB0Jyxcblx0XHRcdFx0JyAgIH0gPiAkbnVsbCcsXG5cdFx0XHRcdCd9Jyxcblx0XHRcdF0sXG5cdFx0XHQnLlNIJzogW1xuXHRcdFx0XHQnZnVuY3Rpb24gY2QgKCkgeyBidWlsdGluIGNkIFwiJEBcIjsgfScsXG5cdFx0XHRcdCdmdW5jdGlvbiBwdXNoZCAoKSB7IGJ1aWx0aW4gcHVzaGQgXCIkQFwiOyB9Jyxcblx0XHRcdFx0J2Z1bmN0aW9uIHBvcGQgKCkgeyBidWlsdGluIHBvcGQgXCIkQFwiOyB9Jyxcblx0XHRcdF0sXG5cdFx0fSk7XG5cdH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cdGZpbmRBdXRvVmVyc2lvbkFzeW5jLFxuXHRhdXRvU3dpdGNoQXN5bmMsXG5cdGVuYWJsZUF1dG9Td2l0Y2gsXG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBLFlBQVksQ0FBQyxvdk9BY0Q7QUFBQSx5RkFaWixHQUFJQSxHQUFFLHlCQUFHQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUc7QUFDekIsS0FBTUMsR0FBRSx5QkFBR0QsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUN4QixLQUFNRSxLQUFJLHlCQUFHRixPQUFPLENBQUMsTUFBTSxDQUFDLEVBRTVCLEtBQU1HLFNBQVEseUJBQUdILE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQ0csUUFBUSxFQUMvQyxLQUFNQyxNQUFLLHlCQUFHSixPQUFPLENBQUMsU0FBUyxDQUFDLEVBRWhDLEtBQU1LLFlBQVcseUJBQUdMLE9BQU8sQ0FBQyxXQUFXLENBQUMsRUFDeEMsR0FBSU0sT0FBTSx5QkFBR04sT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFHO0FBQ2hDLEdBQUlPLGFBQVkseUJBQUdQLE9BQU8sQ0FBQyxhQUFhLENBQUMsRUFBRztBQUM1QyxHQUFJUSxRQUFPLHlCQUFHUixP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