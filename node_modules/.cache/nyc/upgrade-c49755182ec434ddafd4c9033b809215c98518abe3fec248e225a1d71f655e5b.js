// @ts-check
'use strict';function cov_1mvn7vbg5s(){var path="/root/.nvs/lib/upgrade.js";var hash="01c09d399e1ec00a8b630e071a86508b2892c625";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/root/.nvs/lib/upgrade.js",statementMap:{"0":{start:{line:4,column:17},end:{line:4,column:47}},"1":{start:{line:5,column:14},end:{line:5,column:32}},"2":{start:{line:7,column:20},end:{line:7,column:40}},"3":{start:{line:8,column:13},end:{line:8,column:29}},"4":{start:{line:9,column:14},end:{line:9,column:31}},"5":{start:{line:10,column:19},end:{line:10,column:23}},"6":{start:{line:11,column:14},end:{line:11,column:18}},"7":{start:{line:12,column:17},end:{line:12,column:21}},"8":{start:{line:15,column:1},end:{line:27,column:2}},"9":{start:{line:16,column:2},end:{line:16,column:39}},"10":{start:{line:17,column:2},end:{line:19,column:3}},"11":{start:{line:18,column:3},end:{line:18,column:52}},"12":{start:{line:21,column:2},end:{line:21,column:41}},"13":{start:{line:22,column:24},end:{line:22,column:45}},"14":{start:{line:23,column:2},end:{line:25,column:3}},"15":{start:{line:24,column:3},end:{line:24,column:65}},"16":{start:{line:26,column:2},end:{line:26,column:28}},"17":{start:{line:29,column:1},end:{line:29,column:36}},"18":{start:{line:31,column:20},end:{line:31,column:68}},"19":{start:{line:32,column:1},end:{line:61,column:4}},"20":{start:{line:33,column:15},end:{line:33,column:78}},"21":{start:{line:34,column:2},end:{line:35,column:72}},"22":{start:{line:34,column:52},end:{line:35,column:70}},"23":{start:{line:35,column:24},end:{line:35,column:69}},"24":{start:{line:37,column:19},end:{line:37,column:39}},"25":{start:{line:38,column:2},end:{line:42,column:3}},"26":{start:{line:39,column:3},end:{line:41,column:64}},"27":{start:{line:44,column:2},end:{line:46,column:3}},"28":{start:{line:45,column:3},end:{line:45,column:75}},"29":{start:{line:48,column:2},end:{line:48,column:33}},"30":{start:{line:49,column:19},end:{line:49,column:54}},"31":{start:{line:50,column:2},end:{line:60,column:3}},"32":{start:{line:51,column:3},end:{line:51,column:48}},"33":{start:{line:53,column:3},end:{line:53,column:57}},"34":{start:{line:54,column:3},end:{line:59,column:6}},"35":{start:{line:55,column:4},end:{line:57,column:5}},"36":{start:{line:56,column:5},end:{line:56,column:86}},"37":{start:{line:58,column:4},end:{line:58,column:49}},"38":{start:{line:65,column:14},end:{line:65,column:16}},"39":{start:{line:67,column:1},end:{line:67,column:49}},"40":{start:{line:68,column:1},end:{line:68,column:57}},"41":{start:{line:70,column:1},end:{line:70,column:40}},"42":{start:{line:71,column:21},end:{line:71,column:47}},"43":{start:{line:72,column:1},end:{line:77,column:2}},"44":{start:{line:73,column:2},end:{line:73,column:43}},"45":{start:{line:74,column:2},end:{line:76,column:3}},"46":{start:{line:75,column:3},end:{line:75,column:52}},"47":{start:{line:81,column:22},end:{line:81,column:48}},"48":{start:{line:82,column:1},end:{line:87,column:2}},"49":{start:{line:83,column:2},end:{line:83,column:44}},"50":{start:{line:84,column:2},end:{line:86,column:3}},"51":{start:{line:85,column:3},end:{line:85,column:50}},"52":{start:{line:89,column:1},end:{line:89,column:55}},"53":{start:{line:90,column:1},end:{line:90,column:57}},"54":{start:{line:92,column:1},end:{line:92,column:15}},"55":{start:{line:95,column:0},end:{line:97,column:2}}},fnMap:{"0":{name:"upgradeAsync",decl:{start:{line:14,column:9},end:{line:14,column:21}},loc:{start:{line:14,column:31},end:{line:62,column:1}},line:14},"1":{name:"(anonymous_1)",decl:{start:{line:32,column:64},end:{line:32,column:65}},loc:{start:{line:32,column:85},end:{line:61,column:2}},line:32},"2":{name:"(anonymous_2)",decl:{start:{line:34,column:47},end:{line:34,column:48}},loc:{start:{line:34,column:52},end:{line:35,column:70}},line:34},"3":{name:"(anonymous_3)",decl:{start:{line:35,column:19},end:{line:35,column:20}},loc:{start:{line:35,column:24},end:{line:35,column:69}},line:35},"4":{name:"(anonymous_4)",decl:{start:{line:54,column:49},end:{line:54,column:50}},loc:{start:{line:54,column:55},end:{line:59,column:4}},line:54},"5":{name:"upgradeToVersion",decl:{start:{line:64,column:9},end:{line:64,column:25}},loc:{start:{line:64,column:50},end:{line:93,column:1}},line:64}},branchMap:{"0":{loc:{start:{line:15,column:1},end:{line:27,column:2}},type:"if",locations:[{start:{line:15,column:1},end:{line:27,column:2}},{start:{line:15,column:1},end:{line:27,column:2}}],line:15},"1":{loc:{start:{line:17,column:2},end:{line:19,column:3}},type:"if",locations:[{start:{line:17,column:2},end:{line:19,column:3}},{start:{line:17,column:2},end:{line:19,column:3}}],line:17},"2":{loc:{start:{line:21,column:12},end:{line:21,column:40}},type:"binary-expr",locations:[{start:{line:21,column:12},end:{line:21,column:19}},{start:{line:21,column:23},end:{line:21,column:40}}],line:21},"3":{loc:{start:{line:23,column:2},end:{line:25,column:3}},type:"if",locations:[{start:{line:23,column:2},end:{line:25,column:3}},{start:{line:23,column:2},end:{line:25,column:3}}],line:23},"4":{loc:{start:{line:34,column:52},end:{line:35,column:70}},type:"binary-expr",locations:[{start:{line:34,column:52},end:{line:34,column:67}},{start:{line:35,column:3},end:{line:35,column:70}}],line:34},"5":{loc:{start:{line:35,column:24},end:{line:35,column:69}},type:"binary-expr",locations:[{start:{line:35,column:24},end:{line:35,column:43}},{start:{line:35,column:47},end:{line:35,column:69}}],line:35},"6":{loc:{start:{line:38,column:2},end:{line:42,column:3}},type:"if",locations:[{start:{line:38,column:2},end:{line:42,column:3}},{start:{line:38,column:2},end:{line:42,column:3}}],line:38},"7":{loc:{start:{line:38,column:6},end:{line:38,column:66}},type:"binary-expr",locations:[{start:{line:38,column:6},end:{line:38,column:17}},{start:{line:38,column:21},end:{line:38,column:66}}],line:38},"8":{loc:{start:{line:44,column:2},end:{line:46,column:3}},type:"if",locations:[{start:{line:44,column:2},end:{line:46,column:3}},{start:{line:44,column:2},end:{line:46,column:3}}],line:44},"9":{loc:{start:{line:50,column:2},end:{line:60,column:3}},type:"if",locations:[{start:{line:50,column:2},end:{line:60,column:3}},{start:{line:50,column:2},end:{line:60,column:3}}],line:50},"10":{loc:{start:{line:53,column:18},end:{line:53,column:56}},type:"binary-expr",locations:[{start:{line:53,column:18},end:{line:53,column:30}},{start:{line:53,column:34},end:{line:53,column:56}}],line:53},"11":{loc:{start:{line:55,column:4},end:{line:57,column:5}},type:"if",locations:[{start:{line:55,column:4},end:{line:57,column:5}},{start:{line:55,column:4},end:{line:57,column:5}}],line:55},"12":{loc:{start:{line:67,column:14},end:{line:67,column:48}},type:"binary-expr",locations:[{start:{line:67,column:14},end:{line:67,column:24}},{start:{line:67,column:28},end:{line:67,column:48}}],line:67},"13":{loc:{start:{line:70,column:11},end:{line:70,column:39}},type:"binary-expr",locations:[{start:{line:70,column:11},end:{line:70,column:18}},{start:{line:70,column:22},end:{line:70,column:39}}],line:70},"14":{loc:{start:{line:72,column:1},end:{line:77,column:2}},type:"if",locations:[{start:{line:72,column:1},end:{line:77,column:2}},{start:{line:72,column:1},end:{line:77,column:2}}],line:72},"15":{loc:{start:{line:74,column:2},end:{line:76,column:3}},type:"if",locations:[{start:{line:74,column:2},end:{line:76,column:3}},{start:{line:74,column:2},end:{line:76,column:3}}],line:74},"16":{loc:{start:{line:82,column:1},end:{line:87,column:2}},type:"if",locations:[{start:{line:82,column:1},end:{line:87,column:2}},{start:{line:82,column:1},end:{line:87,column:2}}],line:82},"17":{loc:{start:{line:84,column:2},end:{line:86,column:3}},type:"if",locations:[{start:{line:84,column:2},end:{line:86,column:3}},{start:{line:84,column:2},end:{line:86,column:3}}],line:84},"18":{loc:{start:{line:89,column:16},end:{line:89,column:54}},type:"binary-expr",locations:[{start:{line:89,column:16},end:{line:89,column:28}},{start:{line:89,column:32},end:{line:89,column:54}}],line:89}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"01c09d399e1ec00a8b630e071a86508b2892c625"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1mvn7vbg5s=function(){return actualCoverage;};}return actualCoverage;}cov_1mvn7vbg5s();const settings=(cov_1mvn7vbg5s().s[0]++,require('./settings').settings);const Error=(cov_1mvn7vbg5s().s[1]++,require('./error'));const NodeVersion=(cov_1mvn7vbg5s().s[2]++,require('./version'));let nvsUse=(cov_1mvn7vbg5s().s[3]++,require('./use'));// Non-const enables test mocking
let nvsList=(cov_1mvn7vbg5s().s[4]++,require('./list'));// Non-const enables test mocking
let nvsAddRemove=(cov_1mvn7vbg5s().s[5]++,null);// Lazy load
let nvsLink=(cov_1mvn7vbg5s().s[6]++,null);// Lazy load
let nvsMigrate=(cov_1mvn7vbg5s().s[7]++,null);function upgradeAsync(version){cov_1mvn7vbg5s().f[0]++;cov_1mvn7vbg5s().s[8]++;if(!version){cov_1mvn7vbg5s().b[0][0]++;cov_1mvn7vbg5s().s[9]++;version=nvsUse.getCurrentVersion();cov_1mvn7vbg5s().s[10]++;if(!version){cov_1mvn7vbg5s().b[1][0]++;cov_1mvn7vbg5s().s[11]++;throw new Error('Specify a version to upgrade.');}else{cov_1mvn7vbg5s().b[1][1]++;}}else{cov_1mvn7vbg5s().b[0][1]++;cov_1mvn7vbg5s().s[12]++;nvsList=(cov_1mvn7vbg5s().b[2][0]++,nvsList)||(cov_1mvn7vbg5s().b[2][1]++,require('./list'));let resolvedVersion=(cov_1mvn7vbg5s().s[13]++,nvsList.find(version));cov_1mvn7vbg5s().s[14]++;if(!resolvedVersion){cov_1mvn7vbg5s().b[3][0]++;cov_1mvn7vbg5s().s[15]++;throw new Error('Specified version not found.',Error.ENOENT);}else{cov_1mvn7vbg5s().b[3][1]++;}cov_1mvn7vbg5s().s[16]++;version=resolvedVersion;}cov_1mvn7vbg5s().s[17]++;version.os=NodeVersion.defaultOs;let majorVersion=(cov_1mvn7vbg5s().s[18]++,version.semanticVersion.replace(/(\.|-).*$/,''));cov_1mvn7vbg5s().s[19]++;return nvsList.getRemoteVersionsAsync(version.remoteName).then(availableVersions=>{cov_1mvn7vbg5s().f[1]++;let filter=(cov_1mvn7vbg5s().s[20]++,new NodeVersion(version.remoteName,majorVersion,version.arch));cov_1mvn7vbg5s().s[21]++;availableVersions=availableVersions.filter(v=>{cov_1mvn7vbg5s().f[2]++;cov_1mvn7vbg5s().s[22]++;return(cov_1mvn7vbg5s().b[4][0]++,filter.match(v))&&(cov_1mvn7vbg5s().b[4][1]++,v.packages.find(p=>{cov_1mvn7vbg5s().f[3]++;cov_1mvn7vbg5s().s[23]++;return(cov_1mvn7vbg5s().b[5][0]++,p.os===version.os)&&(cov_1mvn7vbg5s().b[5][1]++,p.arch===filter.arch);}));});let newVersion=(cov_1mvn7vbg5s().s[24]++,availableVersions[0]);cov_1mvn7vbg5s().s[25]++;if((cov_1mvn7vbg5s().b[7][0]++,!newVersion)||(cov_1mvn7vbg5s().b[7][1]++,NodeVersion.compare(version,newVersion)<=0)){cov_1mvn7vbg5s().b[6][0]++;cov_1mvn7vbg5s().s[26]++;return['No new version found. '+`${version.semanticVersion} is the latest `+`${version.remoteName}/${majorVersion} version available.`];}else{cov_1mvn7vbg5s().b[6][1]++;}cov_1mvn7vbg5s().s[27]++;if(!settings.quiet){cov_1mvn7vbg5s().b[8][0]++;cov_1mvn7vbg5s().s[28]++;console.log(`Upgrading ${version} to ${newVersion.semanticVersion}...`);}else{cov_1mvn7vbg5s().b[8][1]++;}cov_1mvn7vbg5s().s[29]++;newVersion.arch=version.arch;let newBinPath=(cov_1mvn7vbg5s().s[30]++,nvsUse.getVersionBinary(newVersion));cov_1mvn7vbg5s().s[31]++;if(newBinPath){cov_1mvn7vbg5s().b[9][0]++;cov_1mvn7vbg5s().s[32]++;return upgradeToVersion(version,newVersion);}else{cov_1mvn7vbg5s().b[9][1]++;cov_1mvn7vbg5s().s[33]++;nvsAddRemove=(cov_1mvn7vbg5s().b[10][0]++,nvsAddRemove)||(cov_1mvn7vbg5s().b[10][1]++,require('./addRemove'));cov_1mvn7vbg5s().s[34]++;return nvsAddRemove.addAsync(newVersion).then(()=>{cov_1mvn7vbg5s().f[4]++;cov_1mvn7vbg5s().s[35]++;if(!settings.quiet){cov_1mvn7vbg5s().b[11][0]++;cov_1mvn7vbg5s().s[36]++;console.log(`Added at: ${nvsUse.homePath(nvsUse.getVersionBinary(newVersion))}`);}else{cov_1mvn7vbg5s().b[11][1]++;}cov_1mvn7vbg5s().s[37]++;return upgradeToVersion(version,newVersion);});}});}function upgradeToVersion(oldVersion,newVersion){cov_1mvn7vbg5s().f[5]++;let result=(cov_1mvn7vbg5s().s[38]++,[]);cov_1mvn7vbg5s().s[39]++;nvsMigrate=(cov_1mvn7vbg5s().b[12][0]++,nvsMigrate)||(cov_1mvn7vbg5s().b[12][1]++,require('./migrate'));cov_1mvn7vbg5s().s[40]++;nvsMigrate.migrateGlobalModules(oldVersion,newVersion);cov_1mvn7vbg5s().s[41]++;nvsLink=(cov_1mvn7vbg5s().b[13][0]++,nvsLink)||(cov_1mvn7vbg5s().b[13][1]++,require('./link'));let linkedVersion=(cov_1mvn7vbg5s().s[42]++,nvsLink.getLinkedVersion());cov_1mvn7vbg5s().s[43]++;if(linkedVersion){cov_1mvn7vbg5s().b[14][0]++;cov_1mvn7vbg5s().s[44]++;linkedVersion.os=NodeVersion.defaultOs;cov_1mvn7vbg5s().s[45]++;if(NodeVersion.equal(oldVersion,linkedVersion)){cov_1mvn7vbg5s().b[15][0]++;cov_1mvn7vbg5s().s[46]++;result=result.concat(nvsLink.link(newVersion));}else{cov_1mvn7vbg5s().b[15][1]++;}}else{cov_1mvn7vbg5s().b[14][1]++;}// TODO: Migrate aliases from the old to new version.
let currentVersion=(cov_1mvn7vbg5s().s[47]++,nvsUse.getCurrentVersion());cov_1mvn7vbg5s().s[48]++;if(currentVersion){cov_1mvn7vbg5s().b[16][0]++;cov_1mvn7vbg5s().s[49]++;currentVersion.os=NodeVersion.defaultOs;cov_1mvn7vbg5s().s[50]++;if(NodeVersion.equal(oldVersion,currentVersion)){cov_1mvn7vbg5s().b[17][0]++;cov_1mvn7vbg5s().s[51]++;result=result.concat(nvsUse.use(newVersion));}else{cov_1mvn7vbg5s().b[17][1]++;}}else{cov_1mvn7vbg5s().b[16][1]++;}cov_1mvn7vbg5s().s[52]++;nvsAddRemove=(cov_1mvn7vbg5s().b[18][0]++,nvsAddRemove)||(cov_1mvn7vbg5s().b[18][1]++,require('./addRemove'));cov_1mvn7vbg5s().s[53]++;result=result.concat(nvsAddRemove.remove(oldVersion));cov_1mvn7vbg5s().s[54]++;return result;}cov_1mvn7vbg5s().s[55]++;module.exports={upgradeAsync};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzZXR0aW5ncyIsInJlcXVpcmUiLCJFcnJvciIsIk5vZGVWZXJzaW9uIiwibnZzVXNlIiwibnZzTGlzdCIsIm52c0FkZFJlbW92ZSIsIm52c0xpbmsiLCJudnNNaWdyYXRlIiwidXBncmFkZUFzeW5jIiwidmVyc2lvbiIsImdldEN1cnJlbnRWZXJzaW9uIiwicmVzb2x2ZWRWZXJzaW9uIiwiZmluZCIsIkVOT0VOVCIsIm9zIiwiZGVmYXVsdE9zIiwibWFqb3JWZXJzaW9uIiwic2VtYW50aWNWZXJzaW9uIiwicmVwbGFjZSIsImdldFJlbW90ZVZlcnNpb25zQXN5bmMiLCJyZW1vdGVOYW1lIiwidGhlbiIsImF2YWlsYWJsZVZlcnNpb25zIiwiZmlsdGVyIiwiYXJjaCIsInYiLCJtYXRjaCIsInBhY2thZ2VzIiwicCIsIm5ld1ZlcnNpb24iLCJjb21wYXJlIiwicXVpZXQiLCJjb25zb2xlIiwibG9nIiwibmV3QmluUGF0aCIsImdldFZlcnNpb25CaW5hcnkiLCJ1cGdyYWRlVG9WZXJzaW9uIiwiYWRkQXN5bmMiLCJob21lUGF0aCIsIm9sZFZlcnNpb24iLCJyZXN1bHQiLCJtaWdyYXRlR2xvYmFsTW9kdWxlcyIsImxpbmtlZFZlcnNpb24iLCJnZXRMaW5rZWRWZXJzaW9uIiwiZXF1YWwiLCJjb25jYXQiLCJsaW5rIiwiY3VycmVudFZlcnNpb24iLCJ1c2UiLCJyZW1vdmUiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsidXBncmFkZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdHMtY2hlY2tcbid1c2Ugc3RyaWN0JztcblxuY29uc3Qgc2V0dGluZ3MgPSByZXF1aXJlKCcuL3NldHRpbmdzJykuc2V0dGluZ3M7XG5jb25zdCBFcnJvciA9IHJlcXVpcmUoJy4vZXJyb3InKTtcblxuY29uc3QgTm9kZVZlcnNpb24gPSByZXF1aXJlKCcuL3ZlcnNpb24nKTtcbmxldCBudnNVc2UgPSByZXF1aXJlKCcuL3VzZScpOyAgLy8gTm9uLWNvbnN0IGVuYWJsZXMgdGVzdCBtb2NraW5nXG5sZXQgbnZzTGlzdCA9IHJlcXVpcmUoJy4vbGlzdCcpOyAgLy8gTm9uLWNvbnN0IGVuYWJsZXMgdGVzdCBtb2NraW5nXG5sZXQgbnZzQWRkUmVtb3ZlID0gbnVsbDsgIC8vIExhenkgbG9hZFxubGV0IG52c0xpbmsgPSBudWxsOyAgLy8gTGF6eSBsb2FkXG5sZXQgbnZzTWlncmF0ZSA9IG51bGw7XG5cbmZ1bmN0aW9uIHVwZ3JhZGVBc3luYyh2ZXJzaW9uKSB7XG5cdGlmICghdmVyc2lvbikge1xuXHRcdHZlcnNpb24gPSBudnNVc2UuZ2V0Q3VycmVudFZlcnNpb24oKTtcblx0XHRpZiAoIXZlcnNpb24pIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcignU3BlY2lmeSBhIHZlcnNpb24gdG8gdXBncmFkZS4nKTtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0bnZzTGlzdCA9IG52c0xpc3QgfHwgcmVxdWlyZSgnLi9saXN0Jyk7XG5cdFx0bGV0IHJlc29sdmVkVmVyc2lvbiA9IG52c0xpc3QuZmluZCh2ZXJzaW9uKTtcblx0XHRpZiAoIXJlc29sdmVkVmVyc2lvbikge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdTcGVjaWZpZWQgdmVyc2lvbiBub3QgZm91bmQuJywgRXJyb3IuRU5PRU5UKTtcblx0XHR9XG5cdFx0dmVyc2lvbiA9IHJlc29sdmVkVmVyc2lvbjtcblx0fVxuXG5cdHZlcnNpb24ub3MgPSBOb2RlVmVyc2lvbi5kZWZhdWx0T3M7XG5cblx0bGV0IG1ham9yVmVyc2lvbiA9IHZlcnNpb24uc2VtYW50aWNWZXJzaW9uLnJlcGxhY2UoLyhcXC58LSkuKiQvLCAnJyk7XG5cdHJldHVybiBudnNMaXN0LmdldFJlbW90ZVZlcnNpb25zQXN5bmModmVyc2lvbi5yZW1vdGVOYW1lKS50aGVuKGF2YWlsYWJsZVZlcnNpb25zID0+IHtcblx0XHRsZXQgZmlsdGVyID0gbmV3IE5vZGVWZXJzaW9uKHZlcnNpb24ucmVtb3RlTmFtZSwgbWFqb3JWZXJzaW9uLCB2ZXJzaW9uLmFyY2gpO1xuXHRcdGF2YWlsYWJsZVZlcnNpb25zID0gYXZhaWxhYmxlVmVyc2lvbnMuZmlsdGVyKHYgPT4gZmlsdGVyLm1hdGNoKHYpICYmXG5cdFx0XHR2LnBhY2thZ2VzLmZpbmQocCA9PiBwLm9zID09PSB2ZXJzaW9uLm9zICYmIHAuYXJjaCA9PT0gZmlsdGVyLmFyY2gpKTtcblxuXHRcdGxldCBuZXdWZXJzaW9uID0gYXZhaWxhYmxlVmVyc2lvbnNbMF07XG5cdFx0aWYgKCFuZXdWZXJzaW9uIHx8IE5vZGVWZXJzaW9uLmNvbXBhcmUodmVyc2lvbiwgbmV3VmVyc2lvbikgPD0gMCkge1xuXHRcdFx0cmV0dXJuIFsnTm8gbmV3IHZlcnNpb24gZm91bmQuICcgK1xuXHRcdFx0XHRgJHt2ZXJzaW9uLnNlbWFudGljVmVyc2lvbn0gaXMgdGhlIGxhdGVzdCBgICtcblx0XHRcdFx0YCR7dmVyc2lvbi5yZW1vdGVOYW1lfS8ke21ham9yVmVyc2lvbn0gdmVyc2lvbiBhdmFpbGFibGUuYF07XG5cdFx0fVxuXG5cdFx0aWYgKCFzZXR0aW5ncy5xdWlldCkge1xuXHRcdFx0Y29uc29sZS5sb2coYFVwZ3JhZGluZyAke3ZlcnNpb259IHRvICR7bmV3VmVyc2lvbi5zZW1hbnRpY1ZlcnNpb259Li4uYCk7XG5cdFx0fVxuXG5cdFx0bmV3VmVyc2lvbi5hcmNoID0gdmVyc2lvbi5hcmNoO1xuXHRcdGxldCBuZXdCaW5QYXRoID0gbnZzVXNlLmdldFZlcnNpb25CaW5hcnkobmV3VmVyc2lvbik7XG5cdFx0aWYgKG5ld0JpblBhdGgpIHtcblx0XHRcdHJldHVybiB1cGdyYWRlVG9WZXJzaW9uKHZlcnNpb24sIG5ld1ZlcnNpb24pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRudnNBZGRSZW1vdmUgPSBudnNBZGRSZW1vdmUgfHwgcmVxdWlyZSgnLi9hZGRSZW1vdmUnKTtcblx0XHRcdHJldHVybiBudnNBZGRSZW1vdmUuYWRkQXN5bmMobmV3VmVyc2lvbikudGhlbigoKSA9PiB7XG5cdFx0XHRcdGlmICghc2V0dGluZ3MucXVpZXQpIHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhgQWRkZWQgYXQ6ICR7bnZzVXNlLmhvbWVQYXRoKG52c1VzZS5nZXRWZXJzaW9uQmluYXJ5KG5ld1ZlcnNpb24pKX1gKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gdXBncmFkZVRvVmVyc2lvbih2ZXJzaW9uLCBuZXdWZXJzaW9uKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSk7XG59XG5cbmZ1bmN0aW9uIHVwZ3JhZGVUb1ZlcnNpb24ob2xkVmVyc2lvbiwgbmV3VmVyc2lvbikge1xuXHRsZXQgcmVzdWx0ID0gW107XG5cblx0bnZzTWlncmF0ZSA9IG52c01pZ3JhdGUgfHwgcmVxdWlyZSgnLi9taWdyYXRlJyk7XG5cdG52c01pZ3JhdGUubWlncmF0ZUdsb2JhbE1vZHVsZXMob2xkVmVyc2lvbiwgbmV3VmVyc2lvbik7XG5cblx0bnZzTGluayA9IG52c0xpbmsgfHwgcmVxdWlyZSgnLi9saW5rJyk7XG5cdGxldCBsaW5rZWRWZXJzaW9uID0gbnZzTGluay5nZXRMaW5rZWRWZXJzaW9uKCk7XG5cdGlmIChsaW5rZWRWZXJzaW9uKSB7XG5cdFx0bGlua2VkVmVyc2lvbi5vcyA9IE5vZGVWZXJzaW9uLmRlZmF1bHRPcztcblx0XHRpZiAoTm9kZVZlcnNpb24uZXF1YWwob2xkVmVyc2lvbiwgbGlua2VkVmVyc2lvbikpIHtcblx0XHRcdHJlc3VsdCA9IHJlc3VsdC5jb25jYXQobnZzTGluay5saW5rKG5ld1ZlcnNpb24pKTtcblx0XHR9XG5cdH1cblxuXHQvLyBUT0RPOiBNaWdyYXRlIGFsaWFzZXMgZnJvbSB0aGUgb2xkIHRvIG5ldyB2ZXJzaW9uLlxuXG5cdGxldCBjdXJyZW50VmVyc2lvbiA9IG52c1VzZS5nZXRDdXJyZW50VmVyc2lvbigpO1xuXHRpZiAoY3VycmVudFZlcnNpb24pIHtcblx0XHRjdXJyZW50VmVyc2lvbi5vcyA9IE5vZGVWZXJzaW9uLmRlZmF1bHRPcztcblx0XHRpZiAoTm9kZVZlcnNpb24uZXF1YWwob2xkVmVyc2lvbiwgY3VycmVudFZlcnNpb24pKSB7XG5cdFx0XHRyZXN1bHQgPSByZXN1bHQuY29uY2F0KG52c1VzZS51c2UobmV3VmVyc2lvbikpO1xuXHRcdH1cblx0fVxuXG5cdG52c0FkZFJlbW92ZSA9IG52c0FkZFJlbW92ZSB8fCByZXF1aXJlKCcuL2FkZFJlbW92ZScpO1xuXHRyZXN1bHQgPSByZXN1bHQuY29uY2F0KG52c0FkZFJlbW92ZS5yZW1vdmUob2xkVmVyc2lvbikpO1xuXG5cdHJldHVybiByZXN1bHQ7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXHR1cGdyYWRlQXN5bmMsXG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBLFlBQVksQ0FBQyxpc1JBY0Q7QUFBQSwyRkFaWixLQUFNQSxTQUFRLDBCQUFHQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUNELFFBQVEsRUFDL0MsS0FBTUUsTUFBSywwQkFBR0QsT0FBTyxDQUFDLFNBQVMsQ0FBQyxFQUVoQyxLQUFNRSxZQUFXLDBCQUFHRixPQUFPLENBQUMsV0FBVyxDQUFDLEVBQ3hDLEdBQUlHLE9BQU0sMEJBQUdILE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRztBQUNoQyxHQUFJSSxRQUFPLDBCQUFHSixPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUc7QUFDbEMsR0FBSUssYUFBWSwwQkFBRyxJQUFJLEVBQUc7QUFDMUIsR0FBSUMsUUFBTywwQkFBRyxJQUFJLEVBQUc7QUFDckIsR0FBSUMsV0FBVSwwQkFBRyxJQUFJLEVBRXJCLFFBQVNDLGFBQVksQ0FBQ0MsT0FBTyxDQUFFLGlEQUM5QixHQUFJLENBQUNBLE9BQU8sQ0FBRSxvREFDYkEsT0FBTyxDQUFHTixNQUFNLENBQUNPLGlCQUFpQixFQUFFLENBQUMseUJBQ3JDLEdBQUksQ0FBQ0QsT0FBTyxDQUFFLHFEQUNiLEtBQU0sSUFBSVIsTUFBSyxDQUFDLCtCQUErQixDQUFDLENBQ2pELENBQUMsaUNBQ0YsQ0FBQyxJQUFNLHFEQUNORyxPQUFPLENBQUcsNEJBQUFBLE9BQU8sK0JBQUlKLE9BQU8s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